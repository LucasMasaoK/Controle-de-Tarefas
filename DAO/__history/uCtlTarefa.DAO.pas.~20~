unit uCtlTarefa.DAO;

interface

uses uDM, uCtlTarefa, Datasnap.DBClient;

type
  TCtlTarefaDAO = class
  private
    FConexao: TDM;

  public
    constructor Create;
    property Conexao: TDM read FConexao write FConexao;
    function Pesquisa(oCtlTarefa: TCtlTarefa): TClientDataSet;
  end;

implementation

uses
  Data.SqlExpr, System.SysUtils, Datasnap.Provider;

{ TCtlTarefaDAO }

constructor TCtlTarefaDAO.Create;
begin
  Conexao := TDM.Create;
end;

function TCtlTarefaDAO.Pesquisa(oCtlTarefa: TCtlTarefa): TClientDataSet;
var
  sqlPesquisa: TSQLQuery;
  dspPesquisa: TDataSetProvider;
  cdsPesquisa: TClientDataSet;
begin
  sqlPesquisa := TSQLQuery.Create(nil);
  dspPesquisa := TDataSetProvider.Create(nil);
  cdsPesquisa := TClientDataSet.Create(nil);

  try

    sqlPesquisa := Conexao.getConexao(sqlPesquisa);
    sqlPesquisa.CommandText := 'SELECT * FROM WHERE COD_USUARIO= ' +
     IntToStr(oCtlTarefa.Usuario);
    dspPesquisa.DataSet := sqlPesquisa;
    cdsPesquisa.SetProvider(dspPesquisa);
    try
      cdsPesquisa.Open;
      Result := cdsPesquisa;
    except
      on E: Exception do
      begin
        raise Exception.Create('Error Message' + E.Message);
      end;

    end;

  finally
    FreeAndNil(dspPesquisa);
    FreeAndNil(sqlPesquisa);
  end;
end;

end.
